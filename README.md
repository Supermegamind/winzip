**WinZip**


### 1. Цель работы  
Изучение механизмов шифрования, используемых в ZIP-архивах (ZipCrypto и WinZip AES), и разработка инструмента для восстановления пароля методом полного перебора по заданной маске. В работе реализованы два скрипта:
- `zip_gen.py` — генератор тестовых задач;
- `zip_cracker.py` — программа для подбора пароля.

### Текущая версия кода:
- Поддерживает **оба режима работы**: симулированные данные и реальные ZIP-файлы;
- Обеспечивает **единый интерфейс проверки** независимо от типа входных данных;
- Реализует **оптимизированную проверку ZipCrypto**, включая быструю фильтрацию по контрольным байтам заголовка и полную проверку CRC32 только после прохождения предварительного фильтра;
- Использует **многопроцессорную обработку** на основе `multiprocessing.Pool` с общей остановкой всех процессов при нахождении пароля;
- Обеспечивает **полную совместимость с форматом WinZip AES**, включая PBKDF2, CTR-режим и HMAC-SHA1 аутентификацию.

### 3. Механизм дешифровки  

#### **ZipCrypto**
1. По паролю инициализируются три 32-битных ключа.
2. Каждый байт пароля обновляет ключи с помощью CRC32-подобной функции.
3. Генерируется псевдослучайный поток байтов с помощью функции `stream_byte`.
4. Расшифровка заголовка и тела данных выполняется побайтовым XOR с этим потоком.
5. Проверка корректности:  
   - Последние 2 байта заголовка сравниваются с ожидаемыми (из CRC32 открытого текста);  
   - После успешного сравнения расшифровываются данные, распаковываются (если сжаты) и сверяется CRC32.

#### **WinZip AES (128/256)**
1. Из пароля с помощью **PBKDF2-HMAC-SHA1** (1000 итераций) генерируются:
   - Ключ шифрования (16 или 32 байта),
   - Ключ HMAC,
   - 2-байтовое значение проверки (verification value).
2. **Проверка пароля**: сначала сравнивается verification value с двумя байтами в заголовке.
3. При совпадении — данные расшифровываются в режиме **AES-CTR** (IV = 0).
4. Проверяется **HMAC-SHA1(ciphertext)[:10]** — только при совпадении распаковываются данные.
5. Финальная проверка — сравнение **CRC32 распакованного содержимого** с ожидаемым.


### 4. Использование

Генерация тестовой задачи:
```
python zip_gen.py -p secret123 -m aes256 -o test.txt
```

Подбор пароля:
```
python zip_cracker.py -m ddddd test.txt
```

Программа автоматически определяет тип шифрования и режим работы, выводит прогресс, скорость перебора и результат.
